
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Samples and Measurement &#8212; Quantax 0.2.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=37f418d5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/samples';</script>
    <link rel="canonical" href="https://chenao-phys.github.io/quantax/tutorials/samples.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Square J1-J2 model" href="J1J2.html" />
    <link rel="prev" title="Build your network" href="build_net.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Quantax 0.2.1 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="quick_start.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="exact_diag.html">
    Exact diagonalization
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="build_net.html">
    Build your network
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Samples and Measurement
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="J1J2.html">
    Square J1-J2 model
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="triangular.html">
    Triangular Heisenberg model
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="fermion_mf.html">
    Fermion mean field
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="neural_jastrow.html">
    Neural Jastrow
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="dynamics.html">
    Real-time dynamics
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="local_updates.html">
    Local updates
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../examples/RBM.html">
    Restricted Boltzmann machine
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../examples/TDVP.html">
    Time-dependent variational principle
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../examples/MinSR.html">
    Minimum-norm stochastic reconfiguration
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../examples/Backflow.html">
    Neural network backflow
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../global_defs.html">
    global_defs
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../sites/sites.html">
    sites
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../symmetry/symmetry.html">
    symmetry
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../operator/operator.html">
    operator
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../nn/nn.html">
    nn
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../model/model.html">
    model
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../state/state.html">
    state
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../sampler/sampler.html">
    sampler
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../optimizer/optimizer.html">
    optimizer
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../utils/utils.html">
    utils
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../papers/packages.html">
    Related packages
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../papers/publications.html">
    Research papers
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="quick_start.html">
    Quick Start
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="exact_diag.html">
    Exact diagonalization
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="build_net.html">
    Build your network
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="#">
    Samples and Measurement
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="J1J2.html">
    Square J1-J2 model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="triangular.html">
    Triangular Heisenberg model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="fermion_mf.html">
    Fermion mean field
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="neural_jastrow.html">
    Neural Jastrow
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="dynamics.html">
    Real-time dynamics
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="local_updates.html">
    Local updates
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/RBM.html">
    Restricted Boltzmann machine
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/TDVP.html">
    Time-dependent variational principle
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/MinSR.html">
    Minimum-norm stochastic reconfiguration
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples/Backflow.html">
    Neural network backflow
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../global_defs.html">
    global_defs
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../sites/sites.html">
    sites
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../symmetry/symmetry.html">
    symmetry
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../operator/operator.html">
    operator
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../nn/nn.html">
    nn
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../model/model.html">
    model
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../state/state.html">
    state
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../sampler/sampler.html">
    sampler
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../optimizer/optimizer.html">
    optimizer
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../utils/utils.html">
    utils
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../papers/packages.html">
    Related packages
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../papers/publications.html">
    Research papers
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"></div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Samples and Measurement</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="samples-and-measurement">
<h1>Samples and Measurement<a class="headerlink" href="#samples-and-measurement" title="Link to this heading">#</a></h1>
<p>In this tutorial, we will introduce how to use Quantax to generate samples.</p>
<p>In the beginning, we prepare ground states of transverse-field Ising models from which we will generate samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">quantax</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">qtx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">lattice</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">Square</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="n">H0</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">Ising</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">E0</span><span class="p">,</span> <span class="n">wf0</span> <span class="o">=</span> <span class="n">H0</span><span class="o">.</span><span class="n">diagonalize</span><span class="p">()</span>
<span class="n">state0</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">DenseState</span><span class="p">(</span><span class="n">wf0</span><span class="p">)</span>

<span class="n">H1</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">Ising</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
<span class="n">E1</span><span class="p">,</span> <span class="n">wf1</span> <span class="o">=</span> <span class="n">H1</span><span class="o">.</span><span class="n">diagonalize</span><span class="p">()</span>
<span class="n">state1</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">DenseState</span><span class="p">(</span><span class="n">wf1</span><span class="p">)</span>

<span class="n">H2</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">operator</span><span class="o">.</span><span class="n">Ising</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">E2</span><span class="p">,</span> <span class="n">wf2</span> <span class="o">=</span> <span class="n">H2</span><span class="o">.</span><span class="n">diagonalize</span><span class="p">()</span>
<span class="n">state2</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">DenseState</span><span class="p">(</span><span class="n">wf2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="exact-sampler">
<h2>Exact sampler<a class="headerlink" href="#exact-sampler" title="Link to this heading">#</a></h2>
<p><a class="reference internal" href="../sampler/quantax.sampler.ExactSampler.html#quantax.sampler.ExactSampler" title="quantax.sampler.ExactSampler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExactSampler</span></code></a> generates samples by sampling the full wavefunction. If the provided state is not a <a class="reference internal" href="../state/quantax.state.DenseState.html#quantax.state.DenseState" title="quantax.state.DenseState"><code class="xref py py-class docutils literal notranslate"><span class="pre">DenseState</span></code></a>, it will generate a <a class="reference internal" href="../state/quantax.state.DenseState.html#quantax.state.DenseState" title="quantax.state.DenseState"><code class="xref py py-class docutils literal notranslate"><span class="pre">DenseState</span></code></a> internally through forward pass. The sampler is defined below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler0</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">ExactSampler</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">sampler1</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">ExactSampler</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">sampler2</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">ExactSampler</span><span class="p">(</span><span class="n">state2</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we can generate samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples0</span> <span class="o">=</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples2</span> <span class="o">=</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">samples0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;spins shape&quot;</span><span class="p">,</span> <span class="n">samples0</span><span class="o">.</span><span class="n">spins</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;psi shape&quot;</span><span class="p">,</span> <span class="n">samples0</span><span class="o">.</span><span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Samples(spins=Array([[ 1,  1,  1, ...,  1,  1,  1],
       [ 1,  1,  1, ...,  1,  1,  1],
       [-1, -1, -1, ..., -1, -1, -1],
       ...,
       [ 1,  1,  1, ...,  1,  1,  1],
       [-1, -1, -1, ..., -1, -1, -1],
       [ 1,  1,  1, ...,  1,  1,  1]], dtype=int8), psi=array([-0.62183999, -0.00981954, -0.62184007, ..., -0.62183999,
       -0.62184007, -0.62183999]), state_internal=None, reweight_factor=Array([1., 1., 1., ..., 1., 1., 1.], dtype=float64))
spins shape (1024, 16)
psi shape (1024,)
</pre></div>
</div>
</div>
</div>
<p>The generated sample is a PyTree with 4 terms: <code class="docutils literal notranslate"><span class="pre">spins</span></code>, <code class="docutils literal notranslate"><span class="pre">psi</span></code>, <code class="docutils literal notranslate"><span class="pre">state_internal</span></code>, and <code class="docutils literal notranslate"><span class="pre">reweight_factor</span></code>. Beginners usually only need <code class="docutils literal notranslate"><span class="pre">spins</span></code> and <code class="docutils literal notranslate"><span class="pre">psi</span></code>, which correspond to the generated spin configurations <span class="math notranslate nohighlight">\(s\)</span> and their wavefunctions <span class="math notranslate nohighlight">\(\psi(s)\)</span>. The probability of samples is given by <span class="math notranslate nohighlight">\(|\psi(s)|^2\)</span></p>
<p>Let’s check how magnetization changes by looking at</p>
<div class="math notranslate nohighlight">
\[
\left&lt; M^2 \right&gt; = \left&lt; \left( \frac{1}{N} \sum_i \sigma_i^z \right)^2 \right&gt;.
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">quantax.operator</span><span class="w"> </span><span class="kn">import</span> <span class="n">sigma_z</span>

<span class="n">N</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">Nsites</span>
<span class="n">M</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sigma_z</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">M2</span> <span class="o">=</span> <span class="n">M</span> <span class="o">@</span> <span class="n">M</span>

<span class="n">h</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>

<span class="n">exactM2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">state0</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state0</span><span class="p">,</span> <span class="n">state1</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state1</span><span class="p">,</span> <span class="n">state2</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state2</span><span class="p">])</span>
<span class="n">sampledM2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">samples0</span><span class="p">),</span>
    <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">samples1</span><span class="p">),</span>
    <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state2</span><span class="p">,</span> <span class="n">samples2</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">exactM2</span><span class="p">,</span> <span class="s1">&#39;ks--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sampledM2</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sampled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Transverse field h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\langle M^2 \rangle$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3ce112ce0ad2f1502064e8b98591ece9d33461928c1e2fa8beeb3df16076ca90.png" src="../_images/3ce112ce0ad2f1502064e8b98591ece9d33461928c1e2fa8beeb3df16076ca90.png" />
</div>
</div>
<p>One can also show snapshots from generated samples.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">samples0</span><span class="o">.</span><span class="n">spins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;h=0.0&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">samples1</span><span class="o">.</span><span class="n">spins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;h=3.0&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">samples2</span><span class="o">.</span><span class="n">spins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;h=10.0&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d04af5de4e26ead990b1ed267452417f32d992bd7fcfd850446f017ade881468.png" src="../_images/d04af5de4e26ead990b1ed267452417f32d992bd7fcfd850446f017ade881468.png" />
</div>
</div>
</section>
<section id="metropolis-sampler">
<h2>Metropolis sampler<a class="headerlink" href="#metropolis-sampler" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ExactSampler</span></code> in general cannot be used in large systems, in which case we need metropolis samplers. Below we show how to create a <code class="docutils literal notranslate"><span class="pre">LocalFlip</span></code> sampler, which proposes new spin configurations by flipping spins locally.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler0</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">LocalFlip</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">sampler1</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">LocalFlip</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
<span class="n">sampler2</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">LocalFlip</span><span class="p">(</span><span class="n">state2</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You might have noticed that it takes some time to construct the Metropolis sampler. It’s because the spins stored in the sampler are thermalized during initialization. You can manually set an argument <code class="docutils literal notranslate"><span class="pre">thermal_steps=0</span></code> to initialize without thermalization, but please remember to thermalize spin configurations in the future.</p>
<p>The magnetization can be measured similarly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples0</span> <span class="o">=</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples2</span> <span class="o">=</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>

<span class="n">exactM2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">state0</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state0</span><span class="p">,</span> <span class="n">state1</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state1</span><span class="p">,</span> <span class="n">state2</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state2</span><span class="p">])</span>
<span class="n">sampledM2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">samples0</span><span class="p">),</span>
    <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">samples1</span><span class="p">),</span>
    <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state2</span><span class="p">,</span> <span class="n">samples2</span><span class="p">),</span>
<span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">exactM2</span><span class="p">,</span> <span class="s1">&#39;ks--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">sampledM2</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sampled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Transverse field h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\langle M^2 \rangle$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b996c275661476200d890e195bae8174110e8ac30df311f4835e38bc9a3d4843.png" src="../_images/b996c275661476200d890e195bae8174110e8ac30df311f4835e38bc9a3d4843.png" />
</div>
</div>
<p>By default, the initial thermalization takes 20 * N updates, and each sweep takes 2 * N updates. This is an empirical balance between efficiency and reliability. For better thermalization, one can specify <code class="docutils literal notranslate"><span class="pre">thermal_steps</span></code> and <code class="docutils literal notranslate"><span class="pre">sweep_steps</span></code> arguments in the initialization.</p>
<p>One can also customize metropolis samplers by an inheritance of <code class="docutils literal notranslate"><span class="pre">qtx.sampler.Metropolis</span></code>. Here we show an example of defining a sampler that flips all spins in a lattice.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jaxtyping</span><span class="w"> </span><span class="kn">import</span> <span class="n">Key</span>


<span class="k">class</span><span class="w"> </span><span class="nc">FlipLattice</span><span class="p">(</span><span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">Metropolis</span><span class="p">):</span>

    <span class="nd">@partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnums</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">propose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Key</span><span class="p">,</span> <span class="n">old_spins</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">):</span>
        <span class="n">new_spins</span> <span class="o">=</span> <span class="o">-</span><span class="n">old_spins</span>
        <span class="k">return</span> <span class="n">new_spins</span>
</pre></div>
</div>
</div>
</div>
<p>The sampler we just defined is obviously not ergodic. To make it work, we want to conbine it with <code class="docutils literal notranslate"><span class="pre">LocalFlip</span></code>. This can be done as shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sampler_local</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">LocalFlip</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">896</span><span class="p">,</span> <span class="n">thermal_steps</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sampler_global</span> <span class="o">=</span> <span class="n">FlipLattice</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">nsamples</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">thermal_steps</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sampler_mix</span> <span class="o">=</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">MixSampler</span><span class="p">([</span><span class="n">sampler_local</span><span class="p">,</span> <span class="n">sampler_global</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sampler_mix</span></code> generates 896+128=1024 samples per sweep. In each proposal, there is 896/1024 chance to update all spin configurations by <code class="docutils literal notranslate"><span class="pre">LocalFlip</span></code>, and 128/1024 to update by <code class="docutils literal notranslate"><span class="pre">FlipLattice</span></code>. Here we check the magnetization to verify that the generated samples are still correct.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples</span> <span class="o">=</span> <span class="n">sampler_mix</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact magnetization for h=1.0:&quot;</span><span class="p">,</span> <span class="n">state1</span> <span class="o">@</span> <span class="n">M2</span> <span class="o">@</span> <span class="n">state1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sampled magnetization for h=1.0:&quot;</span><span class="p">,</span> <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">samples1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exact magnetization for h=1.0: 0.29388403111101535
Sampled magnetization for h=1.0: 0.30169677734375
</pre></div>
</div>
</div>
</div>
</section>
<section id="measurement">
<h2>Measurement<a class="headerlink" href="#measurement" title="Link to this heading">#</a></h2>
<p>Now we introduce how to use the generated samples to measure physical quantities.</p>
<p>As we have shown, one can call <code class="docutils literal notranslate"><span class="pre">op.expectation(state,</span> <span class="pre">samples)</span></code> to estimate the expectation value
<span class="math notranslate nohighlight">\(\braket{\hat O}\)</span> of an operator. To estimate the varaince <span class="math notranslate nohighlight">\(\braket{\hat O^2} - \braket{\hat O}^2\)</span> at the same time, one can call</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expectation</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">M2</span><span class="o">.</span><span class="n">expectation</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">samples0</span><span class="p">,</span> <span class="n">return_var</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;h=1.0: &lt;M2&gt; =&quot;</span><span class="p">,</span> <span class="n">expectation</span><span class="p">,</span> <span class="s2">&quot;var(M2) =&quot;</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>h=1.0: &lt;M2&gt; = 0.9398193359375 var(M2) = 0.01366935670375824
</pre></div>
</div>
</div>
</div>
<p>As we know, the uncertainty of an observable <span class="math notranslate nohighlight">\(O\)</span> in Monte Carlo methods is</p>
<div class="math notranslate nohighlight">
\[
u(O) \approx \sqrt{\frac{\mathrm{Var}(O)}{N_s}},
\]</div>
<p>where <span class="math notranslate nohighlight">\(N_s\)</span> is the number of samples. Then we can estimate the uncertainty of the observable as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncertainty</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span> <span class="o">/</span> <span class="n">samples0</span><span class="o">.</span><span class="n">nsamples</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;h=1.0: &lt;M2&gt; = </span><span class="si">{</span><span class="n">expectation</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">uncertainty</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact M2 =&quot;</span><span class="p">,</span> <span class="n">exactM2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>h=1.0: &lt;M2&gt; = 0.9398193359375 ± 0.0036536257547830353
Exact M2 = 0.9399276867036591
</pre></div>
</div>
</div>
</div>
<p>Apart from observables, some other quantities are also important in quantum physics. An important one is the overlap (fidelity) between two states. One can rewrite it as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\mathcal{F}(\psi, \phi) &amp;= \frac{\braket{\psi|\phi} \braket{\phi|\psi}}{\braket{\psi|\psi} \braket{\phi|\phi}} \\
&amp;= \frac{\sum_s \psi^*(s) \phi(s) \sum_{s'} \phi^*(s') \psi(s')}{||\psi||^2 ||\phi||^2} \\
&amp;= \sum_s \frac{|\psi(s)|^2}{||\psi||^2} \frac{\phi(s)}{\psi(s)} \sum_{s'} \frac{|\phi(s')|^2}{||\phi||^2} \frac{\psi(s')}{\phi(s')} \\
&amp;= \left&lt; \frac{\phi(s)}{\psi(s)} \right&gt;_{s \sim |\psi|^2} \left&lt; \frac{\psi(s)}{\phi(s)} \right&gt;_{s \sim |\phi|^2}
\end{aligned}
\end{split}\]</div>
<p>Here, we show the overlap between <code class="docutils literal notranslate"><span class="pre">state0</span></code> and <code class="docutils literal notranslate"><span class="pre">state1</span></code> as an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples0</span> <span class="o">=</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>

<span class="n">s0</span> <span class="o">=</span> <span class="n">samples0</span><span class="o">.</span><span class="n">spins</span>
<span class="n">psi_s0</span> <span class="o">=</span> <span class="n">samples0</span><span class="o">.</span><span class="n">psi</span>
<span class="n">phi_s0</span> <span class="o">=</span> <span class="n">state1</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span>

<span class="n">s1</span> <span class="o">=</span> <span class="n">samples1</span><span class="o">.</span><span class="n">spins</span>
<span class="n">psi_s1</span> <span class="o">=</span> <span class="n">state0</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="n">phi_s1</span> <span class="o">=</span> <span class="n">samples1</span><span class="o">.</span><span class="n">psi</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated overlap: &quot;</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">phi_s0</span> <span class="o">/</span> <span class="n">psi_s0</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">psi_s1</span> <span class="o">/</span> <span class="n">phi_s1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Exact overlap: &quot;</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">state0</span> <span class="o">@</span> <span class="n">state1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estimated overlap:  0.1494855468512831
Exact overlap:  0.14122972655126168
</pre></div>
</div>
</div>
</div>
<p>Another important quantity is the entanglement entropy. In VMC, it’s only convenient to compute the Rényi-2 entropy</p>
<div class="math notranslate nohighlight">
\[
S_2(A, B) = -\log \mathrm{Tr}(\rho_A^2)
\]</div>
<p>when we split the whole system into two subregions A and B.</p>
<p>For a pure state <span class="math notranslate nohighlight">\(\ket{\psi}\)</span>, matrix elements of <span class="math notranslate nohighlight">\(\rho_A\)</span> is given by
$<span class="math notranslate nohighlight">\(
(\rho_A)_{s_A, s_A'} = \frac{\sum_{s_B} \psi(s_A, s_B) \psi^*(s_A', s_B)}{||\psi||^2},
\)</span><span class="math notranslate nohighlight">\(
where \)</span>\ket{s} = \ket{s_A} \otimes \ket{s_B}$ splits a basis state into basis states in two subregions.</p>
<p>Then we can rewrite <span class="math notranslate nohighlight">\(\mathrm{Tr}(\rho_A^2)\)</span> into</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\mathrm{Tr}(\rho_A^2) &amp;= \sum_{s_A, s_A'} (\rho_A)_{s_A, s_A'} (\rho_A)_{s_A', s_A} \\
&amp;= \frac{\sum_{s_A, s_A', s_B, s_B'} \psi(s_A, s_B') \psi^*(s_A', s_B') \psi(s_A', s_B) \psi^*(s_A, s_B)}{||\psi||^4} \\
&amp;= \sum_{s_A, s_A', s_B, s_B'} \frac{|\psi(s_A, s_B) \psi(s_A', s_B')|^2}{||\psi||^4}
\frac{\psi(s_A, s_B') \psi(s_A', s_B)}{\psi(s_A, s_B) \psi(s_A', s_B')} \\
&amp;= \left&lt; \frac{\psi(s_A, s_B') \psi(s_A', s_B)}{\psi(s_A, s_B) \psi(s_A', s_B')} \right&gt;_{s \sim |\psi|^2, s' \sim |\psi|^2}.
\end{aligned}
\end{split}\]</div>
<p>Therefore, the entropy is
$<span class="math notranslate nohighlight">\(
S_2(A, B) = -\log \left&lt; \frac{\psi(s_A, s_B') \psi(s_A', s_B)}{\psi(s_A, s_B) \psi(s_A', s_B')} \right&gt;_{s \sim |\psi|^2, s' \sim |\psi|^2}.
\)</span>$</p>
<p>Here, we show an example of entropy computation, where we split the whole lattice into A and B with equivalent sizes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">entropy</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">qtx</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">Variational</span><span class="p">,</span> <span class="n">samples</span><span class="p">:</span> <span class="n">qtx</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">Samples</span><span class="p">):</span>
    <span class="n">Lx</span><span class="p">,</span> <span class="n">Ly</span> <span class="o">=</span> <span class="n">lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">Ns</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">nsamples</span>
    <span class="n">spins</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">spins</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ns</span><span class="p">,</span> <span class="n">Lx</span><span class="p">,</span> <span class="n">Ly</span><span class="p">)</span>
    <span class="n">sA</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[:</span> <span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:</span> <span class="n">Lx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">sB</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[:</span> <span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">Lx</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span>
    <span class="n">sA_</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[</span><span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="p">:</span> <span class="n">Lx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">sB_</span> <span class="o">=</span> <span class="n">spins</span><span class="p">[</span><span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:,</span> <span class="n">Lx</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span>
    
    <span class="n">swap_s1</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">sA</span><span class="p">,</span> <span class="n">sB_</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">swap_s2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">sA_</span><span class="p">,</span> <span class="n">sB</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">psi1</span> <span class="o">=</span> <span class="n">state</span><span class="p">(</span><span class="n">swap_s1</span><span class="p">)</span>
    <span class="n">psi2</span> <span class="o">=</span> <span class="n">state</span><span class="p">(</span><span class="n">swap_s2</span><span class="p">)</span>

    <span class="n">Tr_rhoA2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">psi1</span> <span class="o">*</span> <span class="n">psi2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">psi</span><span class="p">[:</span> <span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">samples</span><span class="o">.</span><span class="n">psi</span><span class="p">[</span><span class="n">Ns</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]))</span>
    <span class="n">entropy</span> <span class="o">=</span> <span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Tr_rhoA2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">entropy</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">samples0</span> <span class="o">=</span> <span class="n">sampler0</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples1</span> <span class="o">=</span> <span class="n">sampler1</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>
<span class="n">samples2</span> <span class="o">=</span> <span class="n">sampler2</span><span class="o">.</span><span class="n">sweep</span><span class="p">()</span>

<span class="n">S0</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">state0</span><span class="p">,</span> <span class="n">samples0</span><span class="p">)</span>
<span class="n">S1</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">samples1</span><span class="p">)</span>
<span class="n">S2</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">(</span><span class="n">state2</span><span class="p">,</span> <span class="n">samples2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From the exact wave-funciton, one can utilize quspin to compute the exact entropy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">basis</span> <span class="o">=</span> <span class="n">state0</span><span class="o">.</span><span class="n">basis</span>

<span class="n">S0_exact</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">ent_entropy</span><span class="p">(</span><span class="n">state0</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)[</span><span class="s2">&quot;Sent_A&quot;</span><span class="p">]</span>
<span class="n">S1_exact</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">ent_entropy</span><span class="p">(</span><span class="n">state1</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)[</span><span class="s2">&quot;Sent_A&quot;</span><span class="p">]</span>
<span class="n">S2_exact</span> <span class="o">=</span> <span class="n">basis</span><span class="o">.</span><span class="n">ent_entropy</span><span class="p">(</span><span class="n">state2</span><span class="o">.</span><span class="n">psi</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)[</span><span class="s2">&quot;Sent_A&quot;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="n">S0_exact</span><span class="p">,</span> <span class="n">S1_exact</span><span class="p">,</span> <span class="n">S2_exact</span><span class="p">],</span> <span class="s1">&#39;ks--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">],</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sampled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Transverse field h&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$S_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e5b3e6bc819e1795f73aea0e77309cdf193860b27a5835d397c431ddd3be8a02.png" src="../_images/e5b3e6bc819e1795f73aea0e77309cdf193860b27a5835d397c431ddd3be8a02.png" />
</div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="build_net.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Build your network</p>
      </div>
    </a>
    <a class="right-next"
       href="J1J2.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Square J1-J2 model</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exact-sampler">Exact sampler</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metropolis-sampler">Metropolis sampler</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#measurement">Measurement</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/samples.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Ao Chen.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>